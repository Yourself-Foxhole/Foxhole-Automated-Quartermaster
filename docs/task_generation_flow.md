# Task Generation Process Flow

## Overview Diagram
```
┌─────────────────────────────────────────────────────────────────────────┐
│                           Task Generation Flow                           │
└─────────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                        Monitor Building Stockpiles                       │
└─────────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                           Calculate Current State                        │
│  ┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐     │
│  │ Actual Quantity │ ───│ Reserved Amount │ ───│ Current State   │     │
│  └─────────────────┘    └─────────────────┘    └─────────────────┘     │
└─────────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                          Determine Desired State                         │
│  ┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐     │
│  │ Building Default│ ───│ Location Override│ ───│ Desired State   │     │
│  └─────────────────┘    └─────────────────┘    └─────────────────┘     │
└─────────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                            Calculate Gap                                │
│  ┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐     │
│  │ Desired State   │ ───│ Current State   │ ───│ Gap             │     │
│  └─────────────────┘    └─────────────────┘    └─────────────────┘     │
└─────────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                          Determine Action Required                       │
└─────────────────────────────────────────────────────────────────────────┘
                                    │
                    ┌───────────────┴───────────────┐
                    │                               │
                    ▼                               ▼
┌─────────────────────────┐           ┌─────────────────────────┐
│     Need More Items     │           │    Have Excess Items    │
└─────────────────────────┘           └─────────────────────────┘
                    │                               │
                    ▼                               ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                          Calculate Task Priority                         │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐    │
│  │ Base Priority│  │ Gap Size    │  │ Location    │  │ Item        │    │
│  │             │  │ Multiplier  │  │ Importance  │  │ Criticality │    │
│  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘    │
│         │               │               │               │               │
│         └───────────────┴───────────────┴───────────────┘               │
│                               │                                         │
│                               ▼                                         │
│                        Priority Score                                   │
└─────────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                          Generate Task                                  │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐    │
│  │ Task Type   │  │ Priority    │  │ Resources   │  │ Location    │    │
│  │             │  │ Score       │  │ Required    │  │ Details     │    │
│  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘    │
└─────────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                          Add to Task Board                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐    │
│  │ Task ID     │  │ Status      │  │ Created     │  │ Last        │    │
│  │             │  │ (Available) │  │ Timestamp   │  │ Updated     │    │
│  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘    │
└─────────────────────────────────────────────────────────────────────────┘
```

## State-Based Task Generation Rules

### Critical State (🔴)
```
┌─────────────────────────────────────────────────────────────────────────┐
│                           Critical State                                │
└─────────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                        Generate Emergency Task                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐    │
│  │ Highest     │  │ Notify All  │  │ Immediate   │  │ Pin to      │    │
│  │ Priority    │  │ Players     │  │ Action      │  │ Top of      │    │
│  └─────────────┘  └─────────────┘  └─────────────┘  │ Board       │    │
└─────────────────────────────────────────────────────────────────────────┘
```

### Low State (🟡)
```
┌─────────────────────────────────────────────────────────────────────────┐
│                            Low State                                    │
└─────────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                        Generate Warning Task                            │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐    │
│  │ Medium      │  │ Notify      │  │ Planned     │  │ Add to      │    │
│  │ Priority    │  │ Logistics   │  │ Action      │  │ Task Board  │    │
│  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘    │
└─────────────────────────────────────────────────────────────────────────┘
```

### Normal State (🟢)
```
┌─────────────────────────────────────────────────────────────────────────┐
│                           Normal State                                  │
└─────────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                        Monitor for Changes                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐    │
│  │ No Action   │  │ Track       │  │ Update      │  │ Log         │    │
│  │ Required    │  │ Trends      │  │ Statistics  │  │ Metrics     │    │
│  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘    │
└─────────────────────────────────────────────────────────────────────────┘
```

### Oversupply State (💚)
```
┌─────────────────────────────────────────────────────────────────────────┐
│                         Oversupply State                                │
└─────────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                      Generate Redistribution Task                       │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐    │
│  │ Low         │  │ Suggest     │  │ Optimal     │  │ Add to      │    │
│  │ Priority    │  │ Distribution│  │ Routes      │  │ Task Board  │    │
│  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘    │
└─────────────────────────────────────────────────────────────────────────┘
```

## Task Board Management

```
┌─────────────────────────────────────────────────────────────────────────┐
│                        Task Board Management                            │
└─────────────────────────────────────────────────────────────────────────┘
                                    │
                    ┌───────────────┴───────────────┐
                    │                               │
                    ▼                               ▼
┌─────────────────────────┐           ┌─────────────────────────┐
│    Task Board View      │           │    Task Management      │
│  ┌─────────────┐        │           │  ┌─────────────┐        │
│  │ Filter by   │        │           │  │ Claim Task  │        │
│  │ Priority    │        │           │  │ Update      │        │
│  │ Location    │        │           │  │ Status      │        │
│  │ Item Type   │        │           │  │ Mark        │        │
│  └─────────────┘        │           │  │ Complete    │        │
└─────────────────────────┘           │  └─────────────┘        │
                    │                 └─────────────────────────┘
                    │                               │
                    └───────────────┬───────────────┘
                                    │
                    ┌───────────────┴───────────────┐
                    │                               │
                    ▼                               ▼
┌─────────────────────────┐           ┌─────────────────────────┐
│    Task Monitoring      │           │    Task Cleanup         │
│  ┌─────────────┐        │           │  ┌─────────────┐        │
│  │ Track       │        │           │  │ Identify    │        │
│  │ Progress    │        │           │  │ Stale Tasks │        │
│  │ Update      │        │           │  │ Release     │        │
│  │ Statistics  │        │           │  │ Back to     │        │
│  └─────────────┘        │           │  │ Available   │        │
└─────────────────────────┘           └─────────────────────────┘
```

## Task Lifecycle

```
┌─────────────┐     ┌─────────────┐     ┌─────────────┐
│  Available  │────▶│   Claimed   │────▶│  In Progress│
└─────────────┘     └─────────────┘     └─────────────┘
       │                   │                    │
       │                   │                    │
       ▼                   ▼                    ▼
┌─────────────┐     ┌─────────────┐     ┌─────────────┐
│  Released   │◀────│  Completed  │◀────│   Stale     │
└─────────────┘     └─────────────┘     └─────────────┘
```

**Task State Transitions:**
- Available → Claimed: When a player claims a task
- Claimed → In Progress: When work begins on the task
- In Progress → Completed: When task requirements are met
- In Progress → Stale: When no progress is made for a period
- Any State → Released: When task is manually released or becomes stale
- Released → Available: When task is reactivated 